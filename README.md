## Architecture Diagram
### PipeLine-Diagram

![Alt text](https://lh3.googleusercontent.com/fife/ALs6j_Htevfj2gse-GgckTISFM_47LcOOrMh_rdgqvbu_Pjce5eV7-GRLQ8YZQFmkJk4LHZE6X8rt1VHBjSHiYwA9FfvonvrTBJ6BO2VoIPaDgg_Ff9tOdjO-2x-NqavjP3H-27lZKmt9LWO4-KLAQp9d6biHzACDf-I7dPzNG15Ywc8ot7Eoly3C6sl_E1oHMTnsY8rhoDbyAeIJYD12diB06h9ERIB04hdnGVw3NvAUU-c_p5ncMb7UtT9oIWlz4Rt9MC0Rhgl8LDnzxLcRgucrk7mSoYhKx_blb1fk4ZNbh5KTXlTzor-U-aS069yO0CKcjK4RyWJQG-9ux-GFwIwj2cXxdtBIOiYaLKMJ0sGmucE1KlYP-4Wv8Ddddu7Rhca3oV323YrnPUn9e7EhcXtrkWKG3BjGhOT_TENOM3pGHp1OjFZgFsp6jEEa88_QggUsqhVind4ZWIJ8IrQlUPq1eOHEr5sKRM4608YdlhC8u1sWOXQr6ZzhwiWStSDibDhlHVO8s2XEr2DWVZjw22EbukXF-nIIjF5bTRGak8ai5akQSACac-SOGNLAPEtTOPArDOECSqPfr98m_2xvOnwtYri9ZtOmWl7LdrNyOxZyDxlreQKX86cpeT1aO78_l8Ma0pL9cvCjBaFf4VazgcFAcF7dZr0tC9xGSVdte3HpIzZgpV6PObv_eBfXORkGVj9Yvsv5AYcSx_X2v8zkKlrBPOd1SZuUcEnlPQo3W49Ux3Vt0UAs7-MyQXfFysQYIXmjdk5DCGzvGhUz6NVnzZUW808-m4LpcYQBxKL64ZHNzOunUfUH5ssh0nXLRC9-mCGE1pC8wSz86OZGjOrBr6FBWClkHZdnBEVJ1Y7SWRe8iQnpoCBuJ6jKwE7_VVuziqwcgCa7uKTqYFpIhPnQMI9a9wERNrUZ2KvbcfxKf3zi_6JuE8hIjACtngzcruWlY32BKCeAZEj7S8msDiH0iPbWSLSqIXI2mSlk2oBFF-DBlAr7aFYafuP2GpEZmznoASD-lQoOvnIoVYcq03HWNCHLJGOq6TPsZn7Kpp35QvdsNHoylqOdOzPGCw7J1SOQapM4pjCRbb8yqgESoCgB8HcxdjBxLo7bTI-RgJfoh8XE47keV9yocbPOjY4S013nv0Qi3DnuQ-JPzUBajCQBG3l6wzbz-fIoBnHPvQRvdpdN3A2tKcLdeR5BVVB7l6UpdQeyjpNQ1IZl6RjhhontM42QlUngns5_d1Dax4lr58ED0_7FGnQ9zR4RL1Q1j_kuBzOAqUB4rDtiESoPh8RVGjQJy7TU7wdxGRSZJj_uSDyPQ2ui8Q7qlZhahsJ8RCUF4aySoE-b3TYHFaXvJrLizeAQ4PQI6TBtO1UMua6iWsCSiayVTzzO8SnI3xS5KIXXj4sizr3NCCUPpZ8XnUTjgUf5KXbTujuC7V5x00xKmFMYspb-eI6RxJe5YXX7hWziejRWM6GlOMjWcsdJWWga-TJ_Fslxci1AKYUCbjHlv4jgDW6bDGkfmS7aOkDR2sxxcF2Gal9SLJdtPoUQDoCKgg1ptNYEIq4q3hj4L_MuP0khDwTulJ2W4SKkNIsUotr_J0TTeexXKWHvg=w1024-h1006)

### Command-Sequence-Diagram

![Alt text](https://lh3.googleusercontent.com/fife/ALs6j_Hm_unHp-sF2QMEyJJQ8CNaq9Ml2ETmqR9mm01BjVh3EMvdwHRrztZDQWw5UgTCWnddcqekjB8sV8PAa0PzSP7VRVOgAykihml9rZy0GB1Ni7NXdJf9dpFBXxruw33e3YUf6LEDJ0aRn4bJJYpaRXZAAbwZzQ-V2ZjulghyDrgKp6aS3kp8h_figQZGSBxoWa0w-BYvGqx-JpL1EllWEs7u0XtkL1_CItT31BBZm3MvUBvef57a-Tn9gyr7bjDWwN6DNfl68r-GKrJn1ieOFXwUtio5hBap1-GSXAeH_nJbe02MbYcQ9IiXfcIF35T2ytI2skPHLpYYWFFTMX_qk5BiuVbmhYac5wZ2XuvSElv6fqn4O8xV1J1UKa-0tAeXb_9ZidnTApcaZ_6UOLlSjs39KtKwtzqwinjs5GWm82Zwz4MMWLTXTutQJ8c8gW_N2oPuGxOad5aekHqEgSG6lN0WIi0pMBNLHezuvVZ7AmtPRRIbzkzqDvW426LNgJ2ZPFbkSie2YbCfsSObMF5qoQjFYXk-oEPPuAD5GUqpzGdXtJXB3GIiUQvhCENywMfMWqfuRQTycnpYIiROYFlgA1gY7_4bEs6pzR4TNKbg50xoqdM9aw10akLwcacgEQxgPBwicSFha_EXEc6ixfe-p_QdaLcAyZ_rc_QUmdOSl1Jo-itYY12yBP7wKa6FyTBNHa5J605kNfeKb2_FXlPd66JZgIwy5GdyhXsoLStHm5nsp9_1r_xZVRmlpcrErjbCufNRs4hpwAX7TGc_tf4Qr2bRctY9n70GB5KECB7DpDSRHAXUDFi4d8O1K3b4khQBACN_fyR3xT9oYyT-fkqWhNGmbVxgGUG0QCofv-cQ8weAd7xlJKiVHYaTog4Lq6OIVyDI0ITLiTd0uEZBQT4EkIjl6y2mcCUqd5AmHCxo2kEiFc816cjPkNAMCFFxQzFbQ1WLGAKfJbJCauLqz5nVoFL0bQ2GSmUtaQRzV2UhnDwC0peH7J98kivtmAOI6-zwLwrCtDRgMNSUChb275pFeb3usbbumDXtphPgny5H1jCx2JTiu0G7C5VYfGkwSELxD1Cg5o9w9p4rtnr8XmcjEvVMHCgNJUbv21BuWYCTC2RE81zObHtT1ARxD7sCSf6BJsfwXlAvnUpN5-Ot10F07NiVViKBG0w50tNgnOed8UQSDs1lkDd4mVGtrIe0mOMbdpn-WjbvpOUqfewJBl259GHHoXWtGUzrsy3QhaPFLEYk6Xeey0lkoA7Hx6ONe-zuPNI3ByVftGZwwUiqAoH6HWly03Vv4XDTxgVHV7G9BCJhjeRihDXHAKJ_CBjMx2yyv_VGkPNGgyoHt981pUzjMtJCAPMv_RXRtADz_4QW2RW612v2l4s6NZNKvCDhusiqU9k9oFxdkP9PTTnVr9svieb7AwJiEFZzjN4czLdED1LBGZfIhuD-rIdQtfEvC_9xuTXRr_p0vn2jdQ1hijXdM3PRVmQ6tVZ4XrxOISVnIMCI8PgkNbCJXCl1VST8gv_bNRv0Xaonud_1XQfIuAevG0Xuy-CC73OHm2s-I70e7DP5gF5DFuDdbeWGhd09J8JQCn8xcIFD=w2048-h1006)

### Query-Sequence-Diagram

![Alt text](https://lh3.googleusercontent.com/fife/ALs6j_F50Po-GrE1M217Fft2iLS-HHsR4RxvhOgZyE3qM32KSWjaITpjP5tHpsFP9uaoEzFYpmD_HwBtlnJROseaOtSsRwXsFpa7_RbedlwajRi10qUWxQAGD6bYH4QIeji9nfbzS24snHU4H_snG5t4HLdg_gepGRpoi3xtTxNRQH0egJZNHwN640ozjIMpWK2nruEZjMxB-loVwT9IXPm9CmdBOP6ZaYlse4EKTSDxhpPZFILBfRp_qbAbGDUz0Bg9B35p-i4hdj2Se1WdrazanBjO2ZMj4NumsIFXdMj4cV1vhdzTa5j-SCsD2pgFb2PF1v60AmrKmPytgQAnx3Y71-xpHWFL9AeALG343mJKhQgE-hspo6AvJBXRXTj3pAeu2P86lRASBagb9AiNwSUMwfc35HX3MRdnJ0yW0nI_7G9CU1UfsguuUj_mEAzPoyOD2ATE-UQ5AzQ6e61Tq2VQKoQ65lfWdi9jc9n5nV03agTElMHQClG-VvqqwzZrYg5pAs1EfSetqpr_N_K8p2BkQj91sd1a0NmedF_yxBhDw28YP7zHgR6K4mKfhsQBLzIdkzK03e6PgToCCLXrc44ppKJp5UtYFx4RT9e1qm51mcqKzMsfXQSADNc6IFZIsYKYCR-EsOU40_C-ytNkMT7Q8YI4_XoRrG9wVKS7TGvmsePsT6FIRMX4wnYsoFS2f6Eq6e1ql1Y4nEBGwKqMV36VVsXQtXZpabe33vlvI6q9WCSQpdr-QgK5MxFLdZ_SCpE4neNSusQLPFN7RZypJzn0i87D7z_AvTSj3Jb5YcXNY-yeMDY-4Q7Nfw-inCG1k4NHq_vutEQTSU7DNWFvD1zwwkDHricEy_nZ67_ZdM96H6TOCIrBDpFoUizT_PTJSBT1JsOCe6xFc5le6juiVlRmt4qVmkU2lhJaElxeBwv_rDU13lNG7TRJccn674r7yghbEHwGUmdvLX2fJ5heUwFbtdAlLNEGD4Bpj3KpVlJQOdW3j4KDnTPNL8T3NZitTE-EryiKCwVXjKy5-Oy89yaf6moxgz-o0ulh-G28ks0mZm8UvFyy4omCvlCN_U97VhZHMCT6q-Fq_1HrWidR8SugX4kT5QrWFTUs3-e_7YmnB7xMFKWB-aO7GKSTsC_NXaFI6FztLqmbrBXHyFzaxH07Vu4MSkG8ak1ZIxoe7QDN-URpSJ438YxOuzpgFUYsC5FcNGk01Wl0wLcXvRMAaR914yyygnlnnz_FzqA0cU01HZLiFsSgokwQE04_pjXHSnbdelpjaNIWN-v8_Zz2_G6hiANSQeWO3UmpfUn4KEBZjwF7Dn4RFYD9qH-1_ZQaBHlOgQpfZ78xJ1v9RNgV6drtlSUbz55hflYYEl-2nzVakynVd1UlTME9CDIqXtcVtCtkT7LkSmw5els6Rc4__ZfM_-JCjwclEkhmHuCH-QBokCJ65AtQlzBAyVnhpinSR2kuVNqlMa9GqDgUmK0v31J47bd5HahsLnD0_AwpnmSVZZQpmlrC0TMvwt0Mf_p0_rBYfXFqFtbYdbzTt5V3avO1dewrfv1ouUAe-GWnXKJgRyeNHvK_xOw14Q_7HKJN1lFpimdlg_vu=w1088-h1006)

# 아키텍처 설계 문서

## 개요 (Overview)
본 아키텍처는 초고 트래픽(초당 수백만 TPS)에 대응하기 위한 재고 조회/주문/입고 시스템을 설계한 것이다. 이벤트성 상품(예: 갤럭시 이벤트)으로 재고 조회 요청이 폭증할 때, 재고 상태를 효과적으로 관리하고 빠른 응답을 제공하기 위해 NoSQL 및 캐시, 이벤트 기반 구조를 활용한다.

## 목표 (Goals)
- **초고속 재고 조회 처리**: 재고 조회 API 요청에 대해 마이크로초~밀리초 단위 응답을 제공.
- **유연한 확장성(Scalability)**: 트래픽 증가에 따라 무중단으로 수평 확장 가능한 구조.
- **고가용성(High Availability)**: 장애 발생 시에도 서비스를 지속적으로 제공할 수 있는 구조.
- **데이터 정합성(Consistency) 유지**: 주문/입고 시점에 재고량 정확성 보장.

## 요구사항 (Requirements)
- 초당 5,000,000 건 이상의 재고 조회 요청 처리.
- 특정 이벤트 상품에 대한 조회 폭증 시에도 안정적인 응답 시간 유지.
- 주문 처리 시 재고가 부족하면 에러 반환.
- 입고 처리 시 재고 수량 증가 반영.
- 외부 시스템(배송, 결제 등)과의 비동기 연동

1. **API 레이어**:
    - API Gateway를 통해 재고 조회(API), 주문 처리(API), 입고(API)를 라우팅.
   
2. **데이터 레이어 (NoSQL + 캐시)**:
    - **NoSQL**: 재고 상태를 Key-Value 또는 Wide-Column 형태로 관리.
    - **캐시(Redis/Memcached)**: 초고속 조회를 위한 인메모리 캐싱. 특정 "핫아이템"만 캐시해 비용 및 메모리 사용 최적화.
    - **RDB(샤딩된 클러스터)**: 주문 영구 저장 및 SKU/Vendor_Item 메타데이터 관리.

3. **이벤트 기반 처리 레이어**:
    - 메시지 브로커(Kafka 또는 RabbitMQ)를 통한 비동기 이벤트 처리.
    - 주문 이벤트 발행 후, 재고 서비스 또는 주문 서비스가 이벤트를 구독해 상태 변경.
    - 외부 시스템 통지 및 Saga(필요 시) 패턴으로 확장 가능.

## 기술 선택 근거 (Technology Choices)

### NoSQL 선택 이유 (Cassandra 또는 MongoDB)
- **Cassandra**:
    - 선형적 스케일 아웃(노드를 추가하면 읽기/쓰기 처리량이 선형적으로 증가)
    - 높은 쓰기 성능과 빠른 읽기 응답
    - Masterless 아키텍처로 노드 장애 발생 시에도 자동 페일오버 및 높은 가용성
    - 파티션 키를 통한 균등한 부하 분산

- **MongoDB**:
    - Document 지향 모델로 유연한 스키마 관리
    - Sharding 기능을 통해 수평 확장 가능
    - 풍부한 Secondary Index 지원(단, 인덱스 관리 비용 고려)
    - 범용적인 데이터 모델링이 유리할 경우 선택

**결정 포인트:**
- 재고 조회/차감과 같이 단순 Key 기반 접근 및 선형적 확장성이 중요한 경우 Cassandra를 선호
- SKU나 Vendor_item에 대한 다양한 질의 패턴, 문서 형태 저장이 유용하다면 MongoDB 고려
- 본 아키텍처는 **단순 키 기반 조회(fulfillment_center_id:sku_id)로 재고 접근**하므로 Cassandra를 추천 
- Cassandra는 TPS 증가 시 노드를 추가해 성능을 거의 선형적으로 올릴 수 있고, 쓰기/읽기 모두 짧은 레이턴시를 제공함

### 메시지 브로커 (Kafka 또는 RabbitMQ)
- Kafka: 고성능, 파티션 기반 확장, 주문 이벤트와 같은 대량 이벤트 처리에 적합
- RabbitMQ: 메시지 라우팅 플렉서블, 다양한 프로토콜 지원, 소규모 이벤트 처리에도 용이

**결정 포인트:**
- 대용량 스트림성 이벤트와 확장성 중시 → Kafka
- 복잡한 라우팅, 다양한 패턴 지원 필요 → RabbitMQ


## 읽기/쓰기 TPS 증가 시 고려사항

### 읽기 TPS 증가 (재고 조회)
- 캐시 에 해당하는 재고를 Redis 에 상주시켜 마이크로초 단위 응답
- NoSQL 파티션 키 설계로 특정 노드에 과부하가 가지 않도록 분산
- 읽기 TPS 5,000,000에서 Cassandra 클러스터 노드 수를 수십 대까지 확장 가능 (실제 노드 수는 HW 스펙에 따라 상이)
- Redis 클러스터링 및 샤딩으로 In-memory 캐시 확장

### 쓰기 TPS 증가 (주문/입고)
- 쓰기 부하 증가 시 Cassandra의 선형적 스케일링 활용: 노드 추가로 Write TPS 확장
- Cassandra는 수만~수십만 TPS 수준의 쓰기에도 노드 증설로 대응 가능
- MongoDB 샤딩 시 각 샤드에 쓰기 부하를 분산, 샤드 추가로 수평 확장
- 이벤트 버스(Kafka) 파티션 증가로 주문 이벤트 처리량 증가
- Inbound 및 Order Command 처리량 증가 시 마이크로서비스 인스턴스 수 확대(Auto scaling)로 대응

### 가용성과 동시성
- Cassandra: 노드 n개 중 Replication Factor 에 따라 노드 장애에도 읽기/쓰기가 가능한 Eventual Consistency 기반. 가용성 99.99% 이상 확보 가능
- Redis Cluster: 리더-팔로워 구조를 통한 자동 fail-Over, M 가용성을 위한 다중 Replica 구성
- Kafka: Partition Replication 및 broker 장애 시 리더 전환으로 높은 가용성
- 마이크로서비스: Stateless 설계로 인스턴스 장애 시 LB+Auto Scaling 을 통해 무중단 서비스

**수치 예시**(가정):
- Cassandra 노드 10대 구성 시 초당 수백만 건 읽기 + 수십만 건 쓰기 처리 가능 (하드웨어 스펙 및 최적화에 따라 변동)
- Redis 샤드 5~10개, 각각 단일 샤드당 수십만 TPS 처리 가능(메모리 및 네트워크 환경에 따라 상이)
- Kafka 파티션 100개 이상으로 분할하면 수십만~수백만 TPS 이벤트 처리 가능(브로커 수 및 디스크/네트워크 스펙 고려)

## 데이터베이스 및 캐시 구조

- **재고 DB (Cassandra)**:
    - Partition Key: `vendor_item_id`
    - Clustering Key: `fulfillment_center_id`
    - Value: 재고 수량(stock_count), 마지막 업데이트 시각 등
    - 조회/쓰기는 Key 단위 O(1)에 가까운 접근 제공

    
