# 재고 조회시 1,000,000 TPS 발생시 설계

## 요구사항

갤럭시 이벤트로 인해 재고 조회 API(/stock/{{vendorItemId}})의 최대 TPS가 1,000,000

## 설계 전략

 - RDS (r6g.16xlarge)
 - db.r6g.16xlarge core 개수: -  vCPU:64 memory(GiB):512 storage:EBS 전용 전용 EBS 대역폭(Mbps):19,000 네트워킹 성능(Gbps):25
 - 이 인스턴스는 단일 인스턴스로 높은 읽기 트래픽을 견딜 수 있으나, 쓰기 트래픽이 증가할 경우 성능 한계에 도달할 수 있음

## RDS의 처리 가능 트래픽

- r6g.16xlarge 기준으로, 초당 약 10,000~20,000 TPS 의 읽기 트래픽을 견딜 수 있으며, 쓰기 트래픽은 3,000~6,000 TPS 상대적으로 더 낮음

## 외부 Dependency 없이 TPS 처리 방법

 - Read Replica 사용, 쿼리 최적화 및 로컬 캐시를 통한 트래픽 분산
 - 현재는 단일서버 이므로 제한된 메모리에서 사용가능
 - 분산서버로 변경시는 application memory caching 을 하기 때문에 redis 도입이 좋움

## Amazon Aurora 도입 시

- Amazon Aurora는 읽기 복제본 자동 확장을 통해 수십만 TPS의 읽기 트래픽을 처리할 수 있으며, 쓰기 트래픽도 다중 AZ 기반으로 높은 확장성을 가짐

## Redis 도입

- Redis 도입 이유: 데이터베이스의 부하를 줄이고 TPS를 처리하기 위해 자주 조회되는 데이터를 캐싱

- 재고 데이터를 ElastiCache 로 캐싱하고, 조회 시 데이터베이스 대신 캐시된 데이터를 사용하여 TPS 요구사항을 충족

## 추후 구매가 발생할 경우의 처리

- Redis를 사용하지 않을 경우: RDS에 트랜잭션 부하가 집중되며, 쓰기 성능 병목이 발생할 가능성이 있음

- Redis 사용 시: 읽기 요청은 Redis에서 처리하고, 쓰기 요청은 RDS에서 처리하여 트래픽 분산

## 락 제어

- 락의 범위는 최대한 작게 유지 예를 들어, 레코드 단위로 잠금을 걸어 데이터베이스 성능을 극대화





